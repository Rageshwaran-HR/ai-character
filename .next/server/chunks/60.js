exports.id=60,exports.ids=[60],exports.modules={34060:(t,e,s)=>{let i=s(88229),{withAutomaticRetries:n}=s(6530),r=s(61438),a=s(44330),o=s(5493),c=s(73818),h=s(14646),l=s(69637);class u{constructor(t={}){this.auth=t.auth,this.userAgent=t.userAgent||`replicate-javascript/${l.version}`,this.baseUrl=t.baseUrl||"https://api.replicate.com/v1",this.fetch=t.fetch||globalThis.fetch,this.collections={list:r.list.bind(this),get:r.get.bind(this)},this.models={get:o.get.bind(this),versions:{list:o.versions.list.bind(this),get:o.versions.get.bind(this)}},this.predictions={create:c.create.bind(this),get:c.get.bind(this),cancel:c.cancel.bind(this),list:c.list.bind(this)},this.trainings={create:h.create.bind(this),get:h.get.bind(this),cancel:h.cancel.bind(this),list:h.list.bind(this)},this.deployments={predictions:{create:a.predictions.create.bind(this)}}}async run(t,e,s){let{wait:i,...n}=e,r=/[a-zA-Z0-9]+(?:(?:[._]|__|[-]*)[a-zA-Z0-9]+)*/,a=RegExp(`^(?<owner>${r.source})/(?<name>${r.source}):(?<version>[0-9a-fA-F]+)$`),o=t.match(a);if(!o||!o.groups)throw Error('Invalid version. It must be in the format "owner/name:version"');let{version:c}=o.groups,h=await this.predictions.create({...n,version:c});s&&s(h);let{signal:l}=e;if(h=await this.wait(h,i||{},async t=>(s&&s(t),!!l&&!!l.aborted&&(await this.predictions.cancel(t.id),!0))),s&&s(h),"failed"===h.status)throw Error(`Prediction failed: ${h.error}`);return h.output}async request(t,e){let s;let{auth:r,baseUrl:a,userAgent:o}=this;t instanceof URL?s=t:s=new URL(t.startsWith("/")?t.slice(1):t,a.endsWith("/")?a:`${a}/`);let{method:c="GET",params:h={},data:l}=e;Object.entries(h).forEach(([t,e])=>{s.searchParams.append(t,e)});let u=new Headers;r&&u.append("Authorization",`Token ${r}`),u.append("Content-Type","application/json"),u.append("User-Agent",o),e.headers&&e.headers.forEach((t,e)=>{u.append(e,t)});let d={method:c,headers:u,body:l?JSON.stringify(l):void 0},p=await n(async()=>this.fetch(s,d),{shouldRetry:"GET"===c?t=>429===t.status||t.status>=500:t=>429===t.status});if(!p.ok){let t=new Request(s,d),e=await p.text();throw new i(`Request to ${s} failed with status ${p.status} ${p.statusText}: ${e}.`,t,p)}return p}async *paginate(t){let e=await t();yield e.results,e.next&&(yield*this.paginate(()=>this.request(e.next,{method:"GET"}).then(t=>t.json())))}async wait(t,e,s){let{id:i}=t;if(!i)throw Error("Invalid prediction");if("succeeded"===t.status||"failed"===t.status||"canceled"===t.status)return t;let n=t=>new Promise(e=>setTimeout(e,t)),r=e&&e.interval||500,a=await this.predictions.get(i);for(;"succeeded"!==a.status&&"failed"!==a.status&&"canceled"!==a.status&&(!s||await s(a)!==!0);)await n(r),a=await this.predictions.get(t.id);if("failed"===a.status)throw Error(`Prediction failed: ${a.error}`);return a}}t.exports=u},61438:t=>{async function e(t){return(await this.request(`/collections/${t}`,{method:"GET"})).json()}async function s(){return(await this.request("/collections",{method:"GET"})).json()}t.exports={get:e,list:s}},44330:t=>{async function e(t,e,s){let{stream:i,...n}=s;if(n.webhook)try{new URL(n.webhook)}catch(t){throw Error("Invalid webhook URL")}return(await this.request(`/deployments/${t}/${e}/predictions`,{method:"POST",data:{...n,stream:i}})).json()}t.exports={predictions:{create:e}}},88229:t=>{class e extends Error{constructor(t,e,s){super(t),this.name="ApiError",this.request=e,this.response=s}}t.exports=e},5493:t=>{async function e(t,e){return(await this.request(`/models/${t}/${e}`,{method:"GET"})).json()}async function s(t,e){return(await this.request(`/models/${t}/${e}/versions`,{method:"GET"})).json()}async function i(t,e,s){return(await this.request(`/models/${t}/${e}/versions/${s}`,{method:"GET"})).json()}t.exports={get:e,versions:{list:s,get:i}}},73818:t=>{async function e(t){let{stream:e,...s}=t;if(s.webhook)try{new URL(s.webhook)}catch(t){throw Error("Invalid webhook URL")}return(await this.request("/predictions",{method:"POST",data:{...s,stream:e}})).json()}async function s(t){return(await this.request(`/predictions/${t}`,{method:"GET"})).json()}async function i(t){return(await this.request(`/predictions/${t}/cancel`,{method:"POST"})).json()}async function n(){return(await this.request("/predictions",{method:"GET"})).json()}t.exports={create:e,get:s,cancel:i,list:n}},14646:t=>{async function e(t,e,s,i){let{...n}=i;if(n.webhook)try{new URL(n.webhook)}catch(t){throw Error("Invalid webhook URL")}return(await this.request(`/models/${t}/${e}/versions/${s}/trainings`,{method:"POST",data:n})).json()}async function s(t){return(await this.request(`/trainings/${t}`,{method:"GET"})).json()}async function i(t){return(await this.request(`/trainings/${t}/cancel`,{method:"POST"})).json()}async function n(){return(await this.request("/trainings",{method:"GET"})).json()}t.exports={create:e,get:s,cancel:i,list:n}},6530:(t,e,s)=>{let i=s(88229);async function n(t,e={}){let s=e.shouldRetry||(()=>!1),n=e.maxRetries||5,r=e.interval||500,a=e.jitter||100,o=t=>new Promise(e=>setTimeout(e,t)),c=0;do{let h=r*2**c+Math.random()*a;try{let e=await t();if(e.ok||!s(e))return e}catch(t){if(t instanceof i){let e=t.response.headers.get("Retry-After");if(e){if(Number.isInteger(e))h=1e3*e;else{let t=new Date(e);Number.isNaN(t.getTime())||(h=t.getTime()-new Date().getTime())}}}}Number.isInteger(n)&&n>0&&(Number.isInteger(h)&&h>0&&await o(r*2**(e.maxRetries-n)),c+=1)}while(c<n);return t()}t.exports={withAutomaticRetries:n}},69637:t=>{"use strict";t.exports=JSON.parse('{"name":"replicate","version":"0.18.1","description":"JavaScript client for Replicate","repository":"github:replicate/replicate-javascript","homepage":"https://github.com/replicate/replicate-javascript#readme","bugs":"https://github.com/replicate/replicate-javascript/issues","license":"Apache-2.0","main":"index.js","engines":{"node":">=18.0.0","npm":">=7.19.0","git":">=2.11.0","yarn":">=1.7.0"},"scripts":{"check":"tsc","lint":"eslint .","test":"jest"},"devDependencies":{"@types/jest":"^29.5.3","@typescript-eslint/eslint-plugin":"^5.56.0","cross-fetch":"^3.1.5","eslint":"^8.36.0","eslint-config-airbnb-base":"^15.0.0","eslint-plugin-import":"^2.27.5","eslint-plugin-jest":"^27.2.1","eslint-plugin-jsdoc":"^46.2.6","eslint-plugin-n":"^15.6.1","eslint-plugin-promise":"^6.1.1","jest":"^29.6.2","nock":"^13.3.0","ts-jest":"^29.1.0","typescript":"^5.0.2"}}')}};